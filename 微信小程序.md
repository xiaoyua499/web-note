# 微信小程序

## 1.微信⼩程序介绍

> 微信⼩程序，简称⼩程序，英⽂名 Mini Program ，是⼀种不需要下载安装即可使⽤的应⽤，它实现 了应⽤“触⼿可及”的梦想，⽤⼾扫⼀扫或搜⼀下即可打开应⽤

## 2.环境准备

### 1.注册账号 

> 建议使用全新的邮箱，没有注册过其他小程序或者公众号的。访问[[注册⻚⾯](https://mp.weixin.qq.com/wxopen/waregister?action=step1)]`https://mp.weixin.qq.com/wxopen/waregister?action=step1`，耐⼼完成注册即可。

### 2.获取APPID 

> 由于后期调⽤微信⼩程序的接⼝等功能，需要索取开发者的⼩程序中的 APPID ，所以在注册成功后， 可登录，然后获取APPID。 登录，成功后可看到如下界⾯

<img src="C:\Users\30287\Downloads\uTools_1657191392832.png" style="zoom:60%;" />

<img src="C:\Users\30287\Downloads\uTools_1657191440037.png" style="zoom:60%;" />

### 3.开发⼯具

[下载地址](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html

> 微信⼩程序⾃带开发者⼯具，集 开发 预览 调试 发布 于⼀⾝的 完整环境。 但是由于编码的体验不算好，因此 建议使⽤ vs code + 微信小程序编辑工具 来实现编码 vs code 负责敲代码， 微信编辑工具 负责预览

### 4.⼩程序结构⽬录

> ⼩程序框架的⽬标是通过尽可能简单、⾼效的⽅式让开发者可以在微信中开发具有原⽣APP体验的服务。 
> ⼩程序框架提供了⾃⼰的视图层描述语⾔ WXML 和 WXSS ，以及 JavaScript ，并在视图层与逻 辑层间提供了数据传输和事件系统，让开发者能够专注于数据与逻辑。

1. **⼩程序⽂件结构和传统web对⽐**

   | 结构 | 传统web    | 微信⼩程序 |
   | ---- | ---------- | ---------- |
   | 结构 | HTML       | WXML       |
   | 样式 | CSS        | WXSS       |
   | 逻辑 | Javascript | Javascript |
   | 配置 | ⽆         | JSON       |

   通过以上对⽐得出，传统web 是三层结构。⽽微信⼩程序 是四层结构，多了⼀层 配置.json

2. **基本的项⽬⽬录**

   <img src="C:\Users\30287\Downloads\uTools_1657254506498.png" style="zoom:67%;" />

### 5.⼩程序配置⽂件

> ⼀个⼩程序应⽤程序会包括最基本的两种配置⽂件。⼀种是全局的`app.json`和 ⻚⾯⾃⼰的`page.json`
> 注意：配置文件中不能出现注释

#### 1.全局配置app.json

> `app.json`是当前⼩程序的全局配置，包括了⼩程序的所有⻚⾯路径、界⾯表现、⽹络超时时间、底部 tab 等。普通快速启动项⽬⾥边的`app.json`配置

<img src="C:\Users\30287\Downloads\uTools_1657254684630.png" style="zoom:67%;" />

字段的含义 
1. pages 字段⸺⽤于描述当前⼩程序所有⻚⾯路径，这是为了让微信客⼾端知道当前你的⼩程序 ⻚⾯定义在哪个⽬录。 
2. window 字段⸺定义⼩程序所有⻚⾯的顶部背景颜⾊，⽂字颜⾊定义等。 
3. 完整的配置信息请参考 app.json配置

#### 2.⻚⾯配置`page.json`

> 这⾥的`page.json`其实⽤来表⽰⻚⾯⽬录下的`page.json`这类和⼩程序⻚⾯相关的配置。 开发者可以独⽴定义每个⻚⾯的⼀些属性，如顶部颜⾊、是否允许下拉刷新等等。 ⻚⾯的配置只能设置`app.json`中部分 window 配置项的内容，⻚⾯中配置项会覆盖`app.json`的 window 中相同的配置项。

| 属性                         | 类型     | 默认值  | 描述                                                         |
| ---------------------------- | -------- | ------- | ------------------------------------------------------------ |
| navigationBarBackgroundColor | HexColor | #000000 | 导航栏背景颜⾊，如 #000000                                   |
| navigationBarTextStyle       | String   | white   | 导航栏标题颜⾊，仅⽀持 black / white navigationBarTitleText String 导航栏标题⽂字内容 |
| backgroundColor              | HexColor | #ffffff | 窗⼝的背景⾊                                                 |
| backgroundTextStyle          | String   | dark    | 下拉 loading 的样式，仅⽀持 dark / light                     |
| enablePullDownRefresh        | Boolean  | false   | 是否全局开启下拉刷新。 详⻅ Page.onPullDownRefresh           |
| onReachBottomDistance        | Number   | 50      | ⻚⾯上拉触底事件触发时距⻚⾯底部距离，单位为px。 详⻅ Page.onReachBottom |
| disableScroll                | Boolean  | false   | 设置为 true 则⻚⾯整体不能上下滚动；只在⻚⾯配置中有 效，⽆法在 app.json 中设置该项 |

3. sitemap 配置-了解即可

   ⼩程序根⽬录下的 sitemap.json ⽂件⽤于配置⼩程序及其⻚⾯是否允许被微信索引。

## 3.组件

1. view

   > 代替原来的`div`标签

   ```html
     <view hover-class="h-class">
    点击我试试
     </view>
   ```

2. text

   1. ⽂本标签
   2. 只能嵌套text
   3. ⻓按⽂字可以复制（只有该标签有这个功能）
   4. 可以对空格 回⻋ 进⾏编码

   | 属性名     | 类型    | 默认值 | 说明         |
   | ---------- | ------- | ------ | ------------ |
   | selectable | Boolean | false  | ⽂本是否可选 |
   | decode     | Boolean | false  | 是否解码     |

   ```html
     <text selectable="{{false}}" decode="{{false}}">
      普&nbsp;通
     </text>
   ```

3. image

   1. 图⽚标签，image组件默认宽度320px、⾼度240px 
   2. ⽀持懒加载

   | 属性名    | 类型    | 默认值      | 说明                 |
   | --------- | ------- | ----------- | -------------------- |
   | src       | String  |             | 图⽚资源地址         |
   | mode      | String  | scaleToFill | 图⽚裁剪、缩放的模式 |
   | lazy-load | Boolean | false       | 图⽚懒加载           |

4. swiper(微信内置轮播图组件)

   > 滑块视图容器。其中只可放置`swiper-item`组件，否则会导致未定义的行为。

   | 属性名                 | 类型    | 默认值            | 说明                 |
   | ---------------------- | ------- | ----------------- | -------------------- |
   | indicator-dots         | Boolean | false             | 是否显⽰⾯板指⽰点   |
   | indicator-color        | Color   | rgba(0, 0, 0, .3) | 指⽰点颜⾊           |
   | indicator-active-color | Color   | #000000           | 当前选中的指⽰点颜⾊ |
   | autoplay               | Boolean | false             | 是否⾃动切换         |
   | interval               | Number  | 5000              | ⾃动切换时间间隔     |
   | circular               | Boolean | false             | 是否循环轮播         |

5. swiper-item

   > 仅可放置在`swiper`组件中，宽高自动设置为100%。
   
   | 属性                    | 类型    | 默认值 | 说明                                                         |
   | :---------------------- | :------ | :----- | :----------------------------------------------------------- |
   | item-id                 | string  |        | 该 swiper-item 的标识符                                      |
   | skip-hidden-item-layout | boolean | false  | 是否跳过未显示的滑块布局，设为 true 可优化复杂情况下的滑动性能，但会丢失隐藏状态滑块的布局信息 |

6. button

   > 按钮
   
   | 属性 | 类型     | 默认值  |说明                 |
   | :--- | :------- | :------ |:----------------------- |
   |size     | string  | default | 按钮的大小               |
   |type     | string  | default | 按钮的样式类型           |
   |plain    | boolean | false   | 按钮是否镂空，背景色透明 |
   | disabled | boolean | false   | 是否禁用                 |

## 4.模板语法

> WXML（WeiXin Markup Language）是框架设计的⼀套标签语⾔，结合基础组件、事件系统，可以构建出⻚⾯的结构。

### 数据绑定

```html
<!--wxml-->
<view> {{message}} </view>
// page.js
Page({
  data: {
    message: 'Hello MINA!'
  }
})
```

#### 组件属性(需要在双引号之内)

```html
<view id="item-{{id}}"> </view>
Page({
  data: {
    id: 0
  }
})
```

#### 控制属性(需要在双引号之内)

```html
<view wx:if="{{condition}}"> </view>
Page({
  data: {
    condition: true
  }
})
```

#### 运算

> 可以在 `{{}}` 内进行简单的运算，支持的有如下几种方式：

1. 三元运算

```html
<view hidden="{{flag ? true : false}}"> Hidden </view>
```

2. 算数运算

```html
<view> {{a + b}} + {{c}} + d </view>
Page({
  data: {
    a: 1,
    b: 2,
    c: 3
  }
})
```

view中的内容为 `3 + 3 + d`。

3. 逻辑判断

```html
<view wx:if="{{length > 5}}"> </view>
```

4. 字符串运算

```html
<view>{{"hello" + name}}</view>
Page({
  data:{
    name: 'MINA'
  }
})
```


### 列表渲染

```html
<!--wxml-->
<view wx:for="{{array}}"> {{item}} </view>
// page.js
Page({
  data: {
    array: [1, 2, 3, 4, 5]
  }
})
```

#### wx:for

在组件上使用 `wx:for` 控制属性绑定一个数组，即可使用数组中各项的数据重复渲染该组件。

默认数组的当前项的下标变量名默认为 `index`，数组当前项的变量名默认为 `item`

```html
<view wx:for="{{array}}">
  {{index}}: {{item.message}}
</view>
Page({
  data: {
    array: [{
      message: 'foo',
    }, {
      message: 'bar'
    }]
  }
})
```

使用 `wx:for-item` 可以指定数组当前元素的变量名，

使用 `wx:for-index` 可以指定数组当前下标的变量名：

```html
<view wx:for="{{array}}" wx:for-index="idx" wx:for-item="itemName">
  {{idx}}: {{itemName.message}}
</view>
```

`wx:for` 也可以嵌套，下边是一个九九乘法表

```html
<view wx:for="{{[1, 2, 3, 4, 5, 6, 7, 8, 9]}}" wx:for-item="i">
  <view wx:for="{{[1, 2, 3, 4, 5, 6, 7, 8, 9]}}" wx:for-item="j">
    <view wx:if="{{i <= j}}">
      {{i}} * {{j}} = {{i * j}}
    </view>
  </view>
</view>
```

#### block wx:for

类似 `block wx:if`，也可以将 `wx:for` 用在`<block/>`标签上，以渲染一个包含多节点的结构块。例如：

```html
<block wx:for="{{[1, 2, 3]}}">
  <view> {{index}}: </view>
  <view> {{item}} </view>
</block>
```

#### wx:key

如果列表中项目的位置会动态改变或者有新的项目添加到列表中，并且希望列表中的项目保持自己的特征和状态（如 [input](https://developers.weixin.qq.com/miniprogram/dev/component/input.html) 中的输入内容，[switch](https://developers.weixin.qq.com/miniprogram/dev/component/switch.html) 的选中状态），需要使用 `wx:key` 来指定列表中项目的唯一的标识符。

`wx:key` 的值以两种形式提供

1. 字符串，代表在 for 循环的 array 中 item 的某个 property，该 property 的值需要是列表中唯一的字符串或数字，且不能动态改变。
2. 保留关键字 `*this` 代表在 for 循环中的 item 本身，这种表示需要 item 本身是一个唯一的字符串或者数字。

当数据改变触发渲染层重新渲染的时候，会校正带有 key 的组件，框架会确保他们被重新排序，而不是重新创建，以确保使组件保持自身的状态，并且提高列表渲染时的效率。

**如不提供 `wx:key`，会报一个 `warning`， 如果明确知道该列表是静态，或者不必关注其顺序，可以选择忽略。**

### 条件渲染

```html
<!--wxml-->
<view wx:if="{{view == 'WEBVIEW'}}"> WEBVIEW </view>
<view wx:elif="{{view == 'APP'}}"> APP </view>
<view wx:else="{{view == 'MINA'}}"> MINA </view>
// page.js
Page({
  data: {
    view: 'MINA'
  }
})
```

#### wx:if

在框架中，使用 `wx:if=""` 来判断是否需要渲染该代码块：

```html
<view wx:if="{{condition}}"> True </view>
```

也可以用 `wx:elif` 和 `wx:else` 来添加一个 else 块：

```html
<view wx:if="{{length > 5}}"> 1 </view>
<view wx:elif="{{length > 2}}"> 2 </view>
<view wx:else> 3 </view>
```

#### block wx:if

因为 `wx:if` 是一个控制属性，需要将它添加到一个标签上。如果要一次性判断多个组件标签，可以使用一个 `<block/>` 标签将多个组件包装起来，并在上边使用 `wx:if` 控制属性。

```html
<block wx:if="{{true}}">
  <view> view1 </view>
  <view> view2 </view>
</block>
```

**注意：** `<block/>` 并不是一个组件，它仅仅是一个包装元素，不会在页面中做任何渲染，只接受控制属性。

## 5.⼩程序事件的绑定

> ⼩程序中绑定事件，通过bind关键字来实现。如 `bindtap bindinput bindchange` 等不同的组件⽀持不同的事件，具体看组件的说明即可。

```html
<input bindinput="handleInput" />
Page({
  // 绑定的事件
  handleInput: function(e) {
    console.log(e);
    console.log("值被改变了");
 }
})
```

### 特别注意 

1. 绑定事件时不能带参数 不能带括号 以下为错误写法 

   ```html
   <input bindinput="handleInput(100)" />
   ```

   

2. 事件传值 通过标签⾃定义属性的⽅式 和 value 

   ```html
   <input bindinput="handleInput" data-item="100" />
   ```

   

3. 事件触发时获取数据 

   ```js
   handleInput: function(e) {
       // {item:100}
      console.log(e.currentTarget.dataset)
         
       // 输入框的值
      console.log(e.detail.value);
    }
   ```

## WXSS

> WXSS (WeiXin Style Sheets)是一套样式语言，用于描述 WXML 的组件样式。

### 1.与 CSS 相比，WXSS 扩展的特性有

- 尺寸单位
- 样式导入

### 2.尺寸单位

> rpx（responsive pixel）: 可以根据屏幕宽度进行自适应。规定屏幕宽为750rpx。如在 iPhone6 上，屏幕宽度为375px，共有750个物理像素，则750rpx = 375px = 750物理像素，1rpx = 0.5px = 1物理像素。

| 设备         | rpx换算px (屏幕宽度/750) | px换算rpx (750/屏幕宽度) |
| :----------- | :----------------------- | :----------------------- |
| iPhone5      | 1rpx = 0.42px            | 1px = 2.34rpx            |
| iPhone6      | 1rpx = 0.5px             | 1px = 2rpx               |
| iPhone6 Plus | 1rpx = 0.552px           | 1px = 1.81rpx            |

**建议：** 开发微信小程序时设计师可以用 iPhone6 作为视觉稿的标准。

**注意：** 在较小的屏幕上不可避免的会有一些毛刺，请在开发时尽量避免这种情况。

### 3.样式导入

使用`@import`语句可以导入外联样式表，`@import`后跟需要导入的外联样式表的相对路径，用`;`表示语句结束。

**示例代码：**

```less
/** common.wxss **/
.small-p {
  padding:5px;
}
/** app.wxss **/
@import "common.wxss";
.middle-p {
  padding:15px;
}
```

### 4.内联样式

框架组件上支持使用 style、class 属性来控制组件的样式。

- style：静态的样式统一写到 class 中。style 接收动态的样式，在运行时会进行解析，请尽量避免将静态的样式写进 style 中，以免影响渲染速度。

```html
<view style="color:{{color}};" />
```

- class：用于指定样式规则，其属性值是样式规则中类选择器名(样式类名)的集合，样式类名不需要带上`.`，样式类名之间用空格分隔。

```html
<view class="normal_view" />
```

### 5.选择器

目前支持的选择器有：

| 选择器           | 样例             | 样例描述                                       |
| :--------------- | :--------------- | :--------------------------------------------- |
| .class           | `.intro`         | 选择所有拥有 class="intro" 的组件              |
| #id              | `#firstname`     | 选择拥有 id="firstname" 的组件                 |
| element          | `view`           | 选择所有 view 组件                             |
| element, element | `view, checkbox` | 选择所有文档的 view 组件和所有的 checkbox 组件 |
| ::after          | `view::after`    | 在 view 组件后边插入内容                       |
| ::before         | `view::before`   | 在 view 组件前边插入内容                       |

### 6.全局样式与局部样式

定义在 app.wxss 中的样式为全局样式，作用于每一个页面。在 page 的 wxss 文件中定义的样式为局部样式，只作用在对应的页面，并会覆盖 app.wxss 中相同的选择器。
